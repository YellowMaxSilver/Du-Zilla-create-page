<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>
    <script>
        var html = [];
        var textNumber = 1;
        function showHtml(){
            let htmlTxt = "";
            for(let i=0;i < html.length;i++){
                htmlTxt += html[i];
            }
            console.log(htmlTxt);
        }

        class DefaultElements{
            constructor(){
                this.text = "Hello World";
                this.color = "black";
                this.x = 40;
                this.y = 20;

                this.size = 40
                this.width = 'auto'
                this.height = 'auto'
                this.aligment = 'center'
                this.borderSize = 3
                this.borderColor = 'black'
                this.borderRadius = 10
                this.backgroundColor = 'none'
                this.fontFamily = "arial";

                this.nameFunction
                this.idRandom = "Text"+textNumber;
                this.htmlArrayPosition;
                this.htmlCode;
                this.element;
            }
            html(){
                if(this.element == "button"){
                    this.text = "My Button";
                }
                this.htmlCode = `<${this.element} id='${this.idRandom}' 
                style='
                color:${this.color};
                font-size: ${this.size}px;
                margin-left:${this.x}px;
                position:absolute;
                width:${this.width}px;height:${this.height}px;
                border-radius: ${this.borderRadius}px;
                border:${this.borderSize}px solid ${this.borderColor};
                background-color: ${this.backgroundColor};
                font-family: ${this.fontFamily};
                '
                onmouseover='showBorder("${this.idRandom}",${JSON.stringify(this)})'>
                ${this.text}</${this.element}>`;
                //return this.htmlCode;
            }
        }

        class editTextElement{
            constructor(element){
                this.text = "Type Something";
                this.color = "black";
                this.x = 40;
                this.y = 20;

                this.size = 40
                this.width = 'auto'
                this.height = 'auto'
                this.aligment = 'center'
                this.borderSize = 3
                this.borderColor = 'black'
                this.borderRadius = 10
                this.backgroundColor = 'none'
                this.fontFamily = "arial";

                this.nameFunction
                this.idRandom = "Text"+textNumber;
                this.htmlArrayPosition;
                this.htmlCode;
                this.element = "input";
            }
            html(){
                this.htmlCode = `<input id='${this.idRandom}' 
                placeholder='${this.text}'
                style='
                color:${this.color};
                font-size: ${this.size}px;
                margin-left:${this.x}px;
                position:absolute;
                width:${this.width}px;height:${this.height}px;
                border-radius: ${this.borderRadius}px;
                border:${this.borderSize}px solid ${this.borderColor};
                background-color: ${this.backgroundColor};
                font-family: ${this.fontFamily};
                '
                onmouseover='showBorder("${this.idRandom}",${JSON.stringify(this)})'>`;
                //return this.htmlCode;
            }
        }


        function refresh(nameClass){
            let previewSection = document.getElementById('createPreviewContent');
            switch(nameClass.element){
                case ("h1"):
                    html[nameClass.htmlArrayPosition] = 
                    `<${nameClass.element} 
                    id='${nameClass.idRandom}' 
                    style='color:${nameClass.color};
                    font-size: ${nameClass.size}px;
                    margin-left:${nameClass.x}px;
                    margin-top:${nameClass.y}px;
                    width:${nameClass.width}px;height:${nameClass.height}px;
                    border-radius: ${nameClass.borderRadius}px;
                    border:${nameClass.borderSize}px solid ${nameClass.borderColor};
                    background-color: ${nameClass.backgroundColor};
                    font-family: ${nameClass.fontFamily};
                    position:absolute' 
                    onmouseover='showBorder("${nameClass.idRandom}",${JSON.stringify(nameClass)})'>
                    ${nameClass.text}
                    </${nameClass.element}>`;
                break;
                case ("button"):
                    html[nameClass.htmlArrayPosition] = 
                    `<${nameClass.element} 
                    id='${nameClass.idRandom}' 
                    style='color:${nameClass.color};
                    font-size: ${nameClass.size}px;
                    margin-left:${nameClass.x}px;
                    margin-top:${nameClass.y}px;
                    width:${nameClass.width}px;height:${nameClass.height}px;
                    border-radius: ${nameClass.borderRadius}px;
                    border:${nameClass.borderSize}px solid ${nameClass.borderColor};
                    background-color: ${nameClass.backgroundColor};
                    font-family: ${nameClass.fontFamily};
                    position:absolute' 
                    onmouseover='showBorder("${nameClass.idRandom}",${JSON.stringify(nameClass)})'>
                    ${nameClass.text}
                    </${nameClass.element}>`;
                break;
                case("input"):
                    html[nameClass.htmlArrayPosition] = `<input id='${nameClass.idRandom}' 
                        placeholder='${nameClass.text}'
                        style='
                        color:${nameClass.color};
                        font-size: ${nameClass.size}px;
                        margin-left:${nameClass.x}px;
                        margin-top:${nameClass.y}px;
                        position:absolute;
                        width:${nameClass.width}px;height:${nameClass.height}px;
                        border-radius: ${nameClass.borderRadius}px;
                        border:${nameClass.borderSize}px solid ${nameClass.borderColor};
                        background-color: ${nameClass.backgroundColor};
                        font-family: ${nameClass.fontFamily};
                        '
                        onmouseover='showBorder("${nameClass.idRandom}",${JSON.stringify(nameClass)})'>`
                break;
            }

            let trueHtml = "";
            for(let i = 0;i < html.length;i++){
                trueHtml = trueHtml+html[i];
            }
            previewSection.innerHTML = trueHtml;
        }

        function pressed(command){
            let numberArrayHtml;
            let type;
            switch (command){
                case "text":
                    numberArrayHtml = html.length; 
                    type = new DefaultElements();
                    type.element = "h1"
                    type.htmlArrayPosition = numberArrayHtml;
                    type.html()
                break;
                case "button":
                    numberArrayHtml = html.length; 
                    type = new DefaultElements();
                    type.element = "button"
                    type.htmlArrayPosition = numberArrayHtml;
                    type.html()
                break;
                case "input":
                    numberArrayHtml = html.length; 
                    type = new editTextElement();
                    type.htmlArrayPosition = numberArrayHtml;
                    type.html()
                    break;
            }

            html[numberArrayHtml] = type.htmlCode;
            textNumber++;
            faca();
        }
        
        function faca(){
            // teste = new Text();
            // teste.text = "facinha";
            // teste.color = "red";
            // teste.x = 200;

            // html = teste.html();
            let trueHtml = "";
            for(let i = 0;i < html.length;i++){
                trueHtml = trueHtml+html[i];
            }

            let section = document.getElementById('createPreviewContent');
            // section.srcdoc = "<html><body>"+html+"</html>";
            section.innerHTML = trueHtml;
        }


        function setAttributesOfEditBox(classElement){
            let editBox = document.getElementById('proprietyAtributesBox');
            let editText = document.getElementById('attributeEditText');
            let editTextColor = document.getElementById('attributeEditTextColor');
            let editTextSize = document.getElementById('attributeEditTextSize');
            let editTextAligment = document.getElementById('attributeEditTextAligment');
            let editWidth = document.getElementById('attributeEditWidth');
            let editHeight = document.getElementById('attributeEditHeight');
            let editBorderSize = document.getElementById('attributeEditBorderSize');
            let editBorderColor = document.getElementById('attributeEditBorderColor');
            let editBorderRadius = document.getElementById('attributeEditBorderRadius');
            let editBackgroundColor = document.getElementById('attributeEditBackgroundColor');

            let saveButton = document.getElementById('attributeEditSaveButton');

            editText.value = classElement.text;
            editTextColor.value = classElement.color;
            editTextSize.value = classElement.size;
            editTextAligment.value = classElement.aligment;
            editWidth.value = classElement.width;
            editHeight.value = classElement.height;
            editBorderSize.value = classElement.borderSize;
            editBorderColor.value = classElement.borderColor;
            editBorderRadius.value = classElement.borderRadius;
            editBackgroundColor.value = classElement.backgroundColor;

            // setInterval(function(){
            //     if(classElement.htmlArrayPosition== currentArray){
            //         classElement.text= editText.value;
            //         classElement.color= editTextColor.value;
            //         classElement.size= editTextSize.value;
            //         classElement.aligment= editTextAligment.value;
            //         classElement.width= editWidth.value;
            //         classElement.height= editHeight.value;
            //         classElement.borderSize= editBorderSize.value;
            //         classElement.borderColor= editBorderColor.value;
            //         classElement.borderRadius= editBorderRadius.value;
            //         classElement.backgroundColor= editBackgroundColor.value;
            //         refresh(classElement);
            //     }
            // },1000)


            saveButton.addEventListener('click',function(){
                if(classElement.htmlArrayPosition== currentArray){
                    classElement.text= editText.value;
                    classElement.color= editTextColor.value;
                    classElement.size= editTextSize.value;
                    classElement.aligment= editTextAligment.value;
                    classElement.width= editWidth.value;
                    classElement.height= editHeight.value;
                    classElement.borderSize= editBorderSize.value;
                    classElement.borderColor= editBorderColor.value;
                    classElement.borderRadius= editBorderRadius.value;
                    classElement.backgroundColor= editBackgroundColor.value;
                    refresh(classElement);
                }
            })
        }

        var currentArray;
        var clicked = false;
        
        function showBorder(id,nameClass){
            let previewSection = document.getElementById('createPreviewContent');
            let boxSelect = document.getElementById('selectedBox');
            let boxClicked = document.getElementById('clickedBox');

            let elem = document.getElementById(id);
            let proprietyBox = document.getElementById('proprietyBox');
            let showEditButton = document.getElementById('editProprietyButton');

            let editBox = document.getElementById('proprietyAtributesBox');

            let xInput = document.getElementById("positionX");
            let yInput = document.getElementById("positionY");
            let idText = document.getElementById("idTextInput");
            let deleteButton = document.getElementById("deleteButton");

            //elem.classList.add("previewSelected");
            let elementWidth = document.getElementById(nameClass.idRandom).offsetWidth;
            let elementHeight = document.getElementById(nameClass.idRandom).offsetHeight;
            let elementMarginLeft = document.getElementById(nameClass.idRandom).offsetLeft;
            let elementMarginTop = document.getElementById(nameClass.idRandom).offsetTop;

            deleteButton.addEventListener('click',function(){
                if(nameClass.htmlArrayPosition == currentArray){
                    html[nameClass.htmlArrayPosition] = "";
                    let trueHtml = "";
                    for(let i = 0;i < html.length;i++){
                        trueHtml = trueHtml+html[i];
                    }
                    previewSection.innerHTML = trueHtml;
                }
                
            })


            let over = true;

            //if(!clicked){
                boxSelect.style = "width: "+elementWidth+"px;height: "
                +elementHeight+"px;margin-left:"+elementMarginLeft+"px;margin-top:"
                +elementMarginTop+"px;display:flex;";
            //}
            elem.addEventListener('mousedown',function(event){
                    over = true;
                    let mouseInPositionX = event.clientX - document.getElementById(nameClass.idRandom).getBoundingClientRect().left;
                    let mouseInPositionY = event.clientY - document.getElementById(nameClass.idRandom).getBoundingClientRect().top;
                    document.addEventListener('mousemove',function(event){
                        if(over){
                            let distanceLeft = previewSection.getBoundingClientRect().left; 
                            let distanceTop = previewSection.getBoundingClientRect().top;

                            let currentPositionX = (event.clientX-distanceLeft)-mouseInPositionX;
                            let currentPositionY = (event.clientY-distanceTop)-mouseInPositionY;
                            nameClass.x = currentPositionX;
                            nameClass.y = currentPositionY;
        
                                refresh(nameClass);
                                xInput.value = nameClass.x;
                                yInput.value = nameClass.y;
                                document.getElementById(nameClass.idRandom).addEventListener('click',function(){
                                    console.log('clicked');
                                    proprietyBox.classList.remove('invisible');
                                })
                        }
                    });
            })
            document.addEventListener('mouseup',function(){
                over= false;
            })
                 
            
            elem.addEventListener('click',function(){
                
                //elem.classList.remove("previewSelected");
                //elem.classList.add("previewClicked");
                boxClicked.style = "width: "+elementWidth+"px;height: "
                +elementHeight+"px;margin-left:"+elementMarginLeft+"px;margin-top:"
                +elementMarginTop+"px;display:flex;";
                boxClicked.classList.remove('invisible');


                clicked = true;

                let distanceTop = previewSection.getBoundingClientRect().top;
                let distanceLeft = previewSection.getBoundingClientRect().left;  

   
                proprietyBox.classList.remove('invisible')
                showEditButton.addEventListener('click',function(){
                    editBox.classList.remove('invisible');
                    editBox.style = "margin-top:"+(nameClass.y+distanceTop+100)+"px;margin-left:"+(nameClass.x+distanceLeft-20)+"px;z-index:4;"
                    setAttributesOfEditBox(nameClass);
                })



                proprietyBox.style = "margin-top:"+(nameClass.y+distanceTop+70)+"px;margin-left:"+(nameClass.x+distanceLeft-20)+"px;z-index:3;";
                xInput.value = nameClass.x;
                yInput.value = nameClass.y;
                idText.value = nameClass.idRandom;

                currentArray = nameClass.htmlArrayPosition;

                document.getElementById('refreshButton').addEventListener('click',function(){
                    nameClass.x = xInput.value;
                    nameClass.y = yInput.value;
                    nameClass.idRandom = idText.value;
                    refresh(nameClass);
                })



                document.addEventListener('click',function(event){
                    if(!document.getElementById(nameClass.idRandom).contains(event.target) && !(document.getElementById('proprietyBox')).contains(event.target)
                        && !editBox.contains(event.target)){

                        if(currentArray == nameClass.htmlArrayPosition){
                            boxClicked.style = "display:none;"; 
                            boxSelect.style = "display:none;";  

                            proprietyBox.classList.add('invisible');
                            editBox.classList.add('invisible');
                            currentArray = null;

                            console.log('out_clicked');
                            clicked = false;
                        }
                    }
                })
            })
            elem.addEventListener('mouseleave',function(){
                if(!clicked){
                    boxSelect.style = "display: none;";
                }
            })
        }
        //setTimeout(function(){faca()},1000);
    </script>

    <!-- <div class="topBar">  
        <h2>Du-zilla</h2><h2 style="color:rgb(140, 0, 255);margin-left: 20px;">Sites</h2>
    </div> -->
    <section class="tollBox">
        <box style="display: flex;width: 100%;padding-left: 20px;height: 40px;align-items: center;margin-top: 20px;">
            <h4 class="normal_text">Toll Box</h4>
            <div class="selectPreviewBox" style="width: 70px;"><h5 class="normal_text">All</h5></div>
        </box>
        
        <div class="objectsBox">
            <div class="elementObject" onclick="pressed('text')">
                <div class="iconUploadElement" style="background-image: url(./images/icons/user_icon.png);margin-left: 10px;"></div>
                <h4 class="normal_text">Text</h4>
            </div>

            <div class="elementObject" onclick="pressed('button')">
                <div class="iconUploadElement" style="background-image: url(./images/icons/user_icon.png);margin-left: 10px;"></div>
                <h4 class="normal_text">Button</h4>
            </div>

            <div class="elementObject" onclick="pressed('input')">
                <div class="iconUploadElement" style="background-image: url(./images/icons/user_icon.png);margin-left: 10px;"></div>
                <h4 class="normal_text">Edit Text</h4>
            </div>
        </div>

    </section>

    <div class="proprietyAtributesBox invisible" id="proprietyAtributesBox">
        <div class="atribute"><h5 class="normal_text">Text</h5><input class="editInput" id="attributeEditText" value="Hello World"></div>
        <div class="atribute"><h5 class="normal_text">Text Color</h5><input class="editInput" id="attributeEditTextColor" value="Hello World"></div>
        <div class="atribute"><h5 class="normal_text">Text Size</h5><input class="editInput" id="attributeEditTextSize" value="Hello World"></div>
        <div class="atribute"><h5 class="normal_text">Text Aligment</h5><input class="editInput" id="attributeEditTextAligment" value="Hello World"></div>
        <div class="atribute"><h5 class="normal_text">Width</h5><input class="editInput" id="attributeEditWidth" value="0px"></div>
        <div class="atribute"><h5 class="normal_text">Height</h5><input class="editInput" id="attributeEditHeight" value="0px"></div>
        <div class="atribute"><h5 class="normal_text">Border Size</h5><input class="editInput" id="attributeEditBorderSize" value="0px"></div>
        <div class="atribute"><h5 class="normal_text">Border Color</h5><input class="editInput" id="attributeEditBorderColor" value="0px"></div>
        <div class="atribute"><h5 class="normal_text">Border Radius</h5><input class="editInput" id="attributeEditBorderRadius" value="0px"></div>
        <div class="atribute"><h5 class="normal_text">Background Color</h5><input class="editInput" id="attributeEditBackgroundColor" value="0px"></div>
        <button id="attributeEditSaveButton">save</button>
    </div>

    <div class="proprietyBox invisible" id="proprietyBox">
        <h5 class="normal_text" style="margin-left: 10px;">ID</h5>
        <input type="text" autocomplete="off" class="editInput textInput" style="margin-left: 10px;"
        id="idTextInput">
        <h5 class="normal_text" style="margin-left: 10px;">X</h5>
        <input type="text" autocomplete="off" class="editInput numberInput" style="margin-left: 10px;" id="positionX">
        <h5 class="normal_text" style="margin-left: 10px;">Y</h5>
        <input type="text" autocomplete="off" class="editInput numberInput" style="margin-left: 10px;"  id="positionY">
        <div class="proprietyButton" id="editProprietyButton"></div>
        <div class="proprietyButton" id="refreshButton"></div>
        <div class="proprietyButton" id="deleteButton"></div>
    </div>


    <section class="actionSection" style="margin-top: 10px;width: 1000px;margin-right: 50px;">
        <div class="actionButton" id="saveButton" onclick="showHtml()" style="margin-left: 20px;margin-right: 20px;">
          <h4 class="normal_text">Save</h4>
        </div>
        <div class="actionButton" onclick="saveUploadInformations()">
          <h4 class="normal_text">Publish</h4>
        </div>
        <input class="uploadElementInput" style="margin-left: 20px;" value="HelloWorld Project">
    </section>

    
    <sction class="pagePreviewBox">
        <div class="previewOptions">
            <h4 class="normal_text">Preview</h4>
            <div class="selectPreviewBox"><h5 class="normal_text">HelloWorld.dz</h5></div>
        </div>
        <div id="preview" class="createPreview">
            <div id="selectedBox" class="previewSelected"></div>
            <div id="clickedBox" class="previewClicked"></div>
            <div id="createPreviewContent" class="createPreviewContent"></div>
        </div>
        <!-- <iframe id="preview" class="createPreview"></iframe> -->
    </sction>
    
</body>
</html>